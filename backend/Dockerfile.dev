# Dockerfile para Backend - Desenvolvimento
FROM node:18-alpine

# Instalar ferramentas necessÃ¡rias
RUN apk add --no-cache git

# Criar diretÃ³rio de trabalho
WORKDIR /app

# Copiar package.json e package-lock.json
COPY package*.json ./

# Instalar dependÃªncias (incluindo dev)
RUN npm ci

# Copiar cÃ³digo fonte
COPY . .

# Gerar cliente Prisma
RUN npx prisma generate

# Expor porta
EXPOSE 3001

# Criar script de inicializaÃ§Ã£o
RUN echo '#!/bin/sh\n\
echo "ğŸ”„ Aguardando banco de dados..."\n\
while ! nc -z postgres 5432; do\n\
  sleep 1\n\
done\n\
echo "âœ… Banco conectado!"\n\
echo "ğŸ”„ Executando migrations..."\n\
npx prisma migrate deploy\n\
echo "ğŸŒ± Populando banco..."\n\
npm run prisma:seed || true\n\
echo "ğŸš€ Iniciando servidor..."\n\
exec npm run dev' > /app/start.sh && chmod +x /app/start.sh

# Comando padrÃ£o
CMD ["/app/start.sh"]